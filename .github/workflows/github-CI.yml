name: CI EcoVoit 


	
			
jobs:
	run-linters:
		name: ğŸ§¼ Run linters
		runs-on: ubuntu-latest
		on: push
			# push:
			#     branches: [`$`]

		
		steps:
		 - name: ğŸ“Œ Check out Git repository # Verif du repository
		   uses: actions/checkout@v3
		
		 - name: ğŸ› ï¸ Set up Node.js # mis en place de node
		   uses: actions/setup-node@v1
		   with:
			 node-version: 18
  
		 - name: ğŸ¯ Install Node.js dependencies
		   run: |
			cd back
			npm i
			cd ../front
			npm i
  
		 - name: ğŸƒğŸ½ Run linters back
		   uses: wearerequired/lint-action@v2
		   with:
			eslint_dir: ./back
			eslint: true
		
		 - name: ğŸƒğŸ½ Run linters front
		   uses: wearerequired/lint-action@v2
		   with:
			 eslint_dir: ./front
			 eslint: true

		 - name: ğŸ¤— Hello CI 
		   run: echo  "This job's status is ${{ job.status }}."
		
	Test:
	  needs: run-linters
	  name: ğŸ‘¤ Test
	  runs-on: ubuntu-latest
	  on: push

	  steps: 
		- name: ğŸ—‚ï¸ Check out code # rÃ©cupÃ©ration du code source
		uses: actions/checkout@v2
		- name: ğŸ§ Go to tests and run test 
		run: cd ./back && npm test-ci
	
	
	docker:
	  # needs: Test
	  name: ğŸ³ Push on Docker
	  runs-on: ubuntu-latest
	  on: pull--request
	  steps:
		- name: ğŸ¦… Set up QEMU # C'est un logiciel libre, capable d'Ã©muler des ordinateurs et d'administrer des machines virtuelles
		  uses: docker/setup-qemu-action@v2

		- name: ğŸ³ Set up Docker Buildx
		  uses: docker/setup-buildx-action@v2

		- name: ğŸ” Login to Docker Hub
		  uses: docker/login-action@v2
		  with:
			username: ${{ secrets.DOCKERHUB_USERNAME }}
			password: ${{ secrets.DOCKERHUB_TOKEN }}

		- name: ğŸ”¨ Build and push back
		  uses: docker/build-push-action@v4
		  with:
			push: true
			context: "{{defaultContext}}:back"
			tags: "${{ secrets.DOCKERHUB_USERNAME }}/test-docker-ci:latest"
		
		- name: ğŸ”¨ Build and push front
		  uses: docker/build-push-action@v4
		  with:
			push: true
			context: "{{defaultContext}}:front"
			tags: "${{ secrets.DOCKERHUB_USERNAME }}/test-docker-ci:latest"